<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Игра с картами</title>
    <link rel="stylesheet" href="game.css">
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <script src="cards.js"></script>
</head>
<body class="backcol">
    <div class="game-area">
        <!-- Счётчик и кнопка теперь вместе вверху -->
        <div class="top-controls d-flex justify-content-center align-items-center flex-wrap gap-3 px-3 pt-3">
            <div id="score" class="score text-center fw-bold">Правильные: 0 | Неправильные: 0</div>
            <button onclick="checkGuess()" class="btn btn-success">Выбрать карты</button>
        </div>

        <!-- Подсказка полностью убрана -->
        
        <div class="card-container" id="cards"></div>
        <div class="deck" id="deck"></div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const timeParam = urlParams.get('time') || '5';
        const timeoutSeconds = timeParam.toLowerCase() === 'stop' ? 10000 : parseInt(timeParam);
        const timeoutMs = timeoutSeconds * 1000;
        const deckSize = parseInt(urlParams.get('deck')) || 32;
        const mode = urlParams.get('mode') || 'medium';
        const allowedValues = ['7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

        let correct = 0;
        let incorrect = 0;
        let hiddenCards = []; 
        let selectedCards = []; 

        function drawCards() {
            document.getElementById('score').innerText = `Правильные: ${correct} | Неправильные: ${incorrect}`;

            selectedCards = [];
            const deck = document.getElementById('deck');
            deck.innerHTML = '';

            const currentCards = deckSize === 32 ? cards.filter(card => allowedValues.includes(card.value)) : [...cards];
            const deckCards = [...currentCards];
            hiddenCards = [];
            for (let i = 0; i < 3; i++) {
                const randomIndex = Math.floor(Math.random() * deckCards.length);
                hiddenCards.push(deckCards[randomIndex]);
                deckCards.splice(randomIndex, 1);
            }

            const container = document.getElementById('cards');
            container.innerHTML = '';
            hiddenCards.forEach(card => {
                const cardElem = document.createElement('div');
                cardElem.className = 'card';
                cardElem.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <img src="${card.image_url}" alt="${card.name}">
                        </div>
                        <div class="card-back">
                            <img src="./img/card back black.png" alt="Рубашка карты">
                        </div>
                    </div>
                `;
                container.appendChild(cardElem);
            });

            currentCards.forEach(card => {
                const cardElem = document.createElement('div');
                cardElem.className = 'deck-card';
                cardElem.innerHTML = `<img src="${card.image_url}" alt="${card.name}">`;
                cardElem.onclick = () => toggleSelect(cardElem, card);
                deck.appendChild(cardElem);
            });

            setTimeout(() => {
                document.querySelectorAll('.card').forEach(card => card.classList.add('flipped'));
            }, timeoutMs);
        }

        function toggleSelect(elem, card) {
            if (selectedCards.includes(card)) {
                elem.classList.remove('selected');
                selectedCards = selectedCards.filter(c => c !== card);
            } else if (selectedCards.length < 3) {
                elem.classList.add('selected');
                selectedCards.push(card);
            }
        }

        function checkGuess() {
            if (selectedCards.length !== 3) {
                alert('Выберите ровно 3 карты из колоды!');
                return;
            }

            let match = false;

            if (mode === 'easy') {
                const hiddenValues = hiddenCards.map(c => c.value).sort();
                const selectedValues = selectedCards.map(c => c.value).sort();
                match = JSON.stringify(hiddenValues) === JSON.stringify(selectedValues);
            } else if (mode === 'medium') {
                const hiddenNames = hiddenCards.map(c => c.name).sort();
                const selectedNames = selectedCards.map(c => c.name).sort();
                match = JSON.stringify(hiddenNames) === JSON.stringify(selectedNames);
            } else if (mode === 'hard') {
                match = true;
                for (let i = 0; i < 3; i++) {
                    if (hiddenCards[i].name !== selectedCards[i].name) {
                        match = false;
                        break;
                    }
                }
            }

            if (match) correct++; else incorrect++;

            document.querySelectorAll('.deck-card').forEach(card => card.classList.remove('selected'));
            drawCards();
        }

        drawCards();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>   
    <script src="script.js"></script>
</body>
</html>
</DOCUMENT>
